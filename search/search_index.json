{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Terraform Exporter for SAP BTP","text":"<p>The Terraform Exporter for SAP BTP (btptf CLI) is a handy tool that makes it easier to bring your existing SAP Business Technology Platform (BTP) resources into Terraform or OpenTofu.</p> <p>With it, you can take things like subaccounts and directories in BTP and turn them into Terraform/OpenTofu state and configuration files. It is especially useful for teams who are moving to Terraform/OpenTofu but still need to manage older infrastructure or SAP BTP accounts that are already set up.</p>"},{"location":"#how-does-it-work","title":"How does it work","text":"<ul> <li>Resource Identification: Terraform Exporter for SAP BTP identifies the SAP BTP resources and maps them to corresponding Terraform resources using the BTP CLI Server APIs.</li> <li>Import Process: The tool utilizes Terraform's import function to integrate each resource into Terraform's state.</li> <li>Configuration Generation: After import, it generates the Terraform code (in HashiCorp Configuration Language - HCL) for each resource, enabling further customizations as needed.</li> </ul> <p>The same steps apply when using OpenTofu.</p>"},{"location":"btptf/","title":"Terraform exporter for SAP BTP","text":"<p>This document explains the syntax and parameters for the various Terraform exporter for SAP BTP commands.</p>"},{"location":"btptf/#btptf","title":"btptf","text":"<p>Terraform Exporter for SAP BTP</p>"},{"location":"btptf/#options","title":"Options","text":"<pre><code>  -h, --help      help for btptf\n      --verbose    Enable verbose output for debugging\n</code></pre>"},{"location":"btptf/#see-also","title":"See also","text":"<ul> <li>btptf create-json: Create a JSON file with a list of resources</li> <li>btptf export: Export resources from SAP BTP</li> <li>btptf export-by-json: Export resources from SAP BTP via JSON file</li> </ul>"},{"location":"btptf/#btptf-create-json","title":"btptf create-json","text":"<p>Create a JSON file with a list of resources</p> <pre><code>btptf create-json [flags]\n</code></pre>"},{"location":"btptf/#options_1","title":"Options","text":"<pre><code>  -d, --directory string      ID of the directory\n  -h, --help                  help for create-json\n  -o, --organization string   ID of the Cloud Foundry organization\n  -p, --path string           Full path to JSON file with list of resources (default \"btpResources_&lt;account-id&gt;.json\")\n  -r, --resources string      Comma-separated list of resources to be included (default \"all\")\n  -s, --subaccount string     ID of the subaccount\n</code></pre>"},{"location":"btptf/#options-inherited-from-parent-commands","title":"Options inherited from parent commands","text":"<pre><code>      --verbose    Enable verbose output for debugging\n</code></pre>"},{"location":"btptf/#see-also_1","title":"See also","text":"<ul> <li>Back to top</li> </ul>"},{"location":"btptf/#btptf-export","title":"btptf export","text":"<p>Export resources from SAP BTP</p> <pre><code>btptf export [flags]\n</code></pre>"},{"location":"btptf/#options_2","title":"Options","text":"<pre><code>  -c, --config-dir string     Directory for the Terraform code (default \"generated_configurations_&lt;account-id&gt;\")\n  -d, --directory string      ID of the directory\n  -h, --help                  help for export\n  -o, --organization string   ID of the Cloud Foundry organization\n  -r, --resources string      Comma-separated list of resources to be included (default \"all\")\n  -s, --subaccount string     ID of the subaccount\n</code></pre>"},{"location":"btptf/#options-inherited-from-parent-commands_1","title":"Options inherited from parent commands","text":"<pre><code>      --verbose    Enable verbose output for debugging\n</code></pre>"},{"location":"btptf/#see-also_2","title":"See also","text":"<ul> <li>Back to top</li> </ul>"},{"location":"btptf/#btptf-export-by-json","title":"btptf export-by-json","text":"<p>Export resources from SAP BTP via JSON file</p> <pre><code>btptf export-by-json [flags]\n</code></pre>"},{"location":"btptf/#options_3","title":"Options","text":"<pre><code>  -c, --config-dir string     Directory for the Terraform code (default \"generated_configurations_&lt;account-id&gt;\")\n  -d, --directory string      ID of the directory\n  -h, --help                  help for export-by-json\n  -o, --organization string   ID of the Cloud Foundry organization\n  -p, --path string           Full path to JSON file with list of resources (default \"btpResources_&lt;account-id&gt;.json\")\n  -s, --subaccount string     ID of the subaccount\n</code></pre>"},{"location":"btptf/#options-inherited-from-parent-commands_2","title":"Options inherited from parent commands","text":"<pre><code>      --verbose    Enable verbose output for debugging\n</code></pre>"},{"location":"btptf/#see-also_3","title":"See also","text":"<ul> <li>Back to top</li> </ul>"},{"location":"concepts/","title":"Concepts","text":"<p>The Terraform Exporter for SAP BTP (btptf CLI) provides a convenience functionality to import existing subaccounts on SAP BTP into Terraform/OpenTofu configurations. The configurations delivered by the btptf CLI are:</p> <ul> <li>Provider configuration (excluding credentials)</li> <li>Import blocks for the resources</li> <li>Resource configuration retrieved from the platform</li> </ul> <p>The btptf CLI offers two options for the import:</p> <ol> <li> <p>As a one-step process via creating the import configuration by naming the resource types.</p> </li> <li> <p>As a two-step process via creating a local JSON file with the resources to be imported. This file can be adjusted and then used as a configuration for the import.</p> </li> </ol>"},{"location":"concepts/#basic-flow","title":"Basic Flow","text":"<ol> <li> <p>Fetching and parsing the markdown documentation for the resource from the provider repository (publicly available) to collect the information on the resource keys needed for the import.</p> </li> <li> <p>Creating the files with the import block based on the information from the documentation and reading the data from the platform leveraging the corresponding Terraform data sources.</p> </li> <li> <p>Executing the Terraform/OpenTofu commands via Terraform/OpenTofu CLI to generate the resource configuration and store the results in the file system.</p> </li> </ol> <p>The following points should be mentioned:</p> <ol> <li> <p>The authentication to be able to read the data from the platform leverages the options provided by the Terraform Provider for SAP BTP. The values must be provided via environment variables. No value is stored in the CLI or in any of the generated configuration files. The resources the user has access are the ones that are reflected in the role collections assigned to the authenticated user.</p> </li> <li> <p>No state file is created by the btptf CLI. The reason is that we want to enable best practices and allow the user to add a remote state storage configuration (always customer specific) to the configuration before triggering the state import.</p> </li> </ol>"},{"location":"gettingstarted/","title":"Getting Started","text":"<p>The btptf CLI offers several commands for the export of Terraform configurations of SAP BTP. Currently the CLI supports exporting of SAP BTP resources like Subaccounts and directories. The CLI supports two ways to export BTP resources - Exporting resources via JSON - Exporting resources</p>"},{"location":"gettingstarted/#exporting-resources-via-json","title":"Exporting Resources via JSON","text":"<p>This is a two-step process where the JSON can be created manually or via <code>btptf create-json</code> command</p> <ol> <li>Create a JSON file with a list of BTP resources that can be imported </li> </ol> <p><pre><code>btptf create-json - s &lt;subaccount id&gt;\n</code></pre> Review and adapt the JSON file and remove resources which need not be imported. </p> <ol> <li>Export resources from SAP BTP via a JSON file</li> </ol> <pre><code>btptf export-by-json -p &lt;path to json file&gt;\n</code></pre>"},{"location":"gettingstarted/#exporting-resources","title":"Exporting Resources","text":"<p>Export resources from SAP BTP</p> <pre><code>btptf export -s &lt;subaccount id&gt;\n</code></pre> <p>You find a comprehensive overview of the commands and the options in the documentation.</p>"},{"location":"gettingstarted/#examples","title":"Examples","text":"<p>The below example explains how to use the Terraform Exporter for SAP BTP to export the Terraform configuration for an existing SAP BTP Subaccount and use it to generate the Terraform state. Post this the BTP Subaccount can be managed by Terraform.</p> <ol> <li> <p>Launch SAP BTP Cockpit and navigate to an existing subaccount or create a new subaccount. </p> </li> <li> <p>In the Subaccount, navigate to the 'Overview' tab and find the 'Subaccount ID'</p> </li> <li> <p>Generate the json file which contains the list of resources to be exported. This json file can be generated by running the btptf CLI command btptf create-json - s  <pre><code>btptf create-json - s 9d3471e7-a6b3-48e2-ae4b-b9426bb24cd1\n</code></pre>    The resources list file with the name btpResources_.json e.g <code>btpResources_9d3471e7-a6b3-48e2-ae4b-b9426bb24cd1.json</code> gets generated.     <li> <p>Edit the json file and remove the resources which need not be exported and managed by Terraform.</p> </li> <li> <p>Run the btptf CLI command to export Terraform configuration using the json file. btptf export-by-json -p btpResources_.json -s  <pre><code>btptf export-by-json -p btpResources_9d3471e7-a6b3-48e2-ae4b-b9426bb24cd1.json -s 9d3471e7-a6b3-48e2-ae4b-b9426bb24cd1\n</code></pre> <li> <p>The Terraform configurations will be generated under the folder <code>generated_configurations_9d3471e7-a6b3-48e2-ae4b-b9426bb24cd1</code>. The output of the command will show an export summary which contains the information about which 'Resource Names' and their respective count.  </p> </li> <li> <p>Review the readme file NextSteps.md under the folder <code>generated_configurations_9d3471e7-a6b3-48e2-ae4b-b9426bb24cd1</code> and adapt the Terraform configuration files as mentioned in the NextSteps.md</p> </li> <li> <p>In the terminal, navigate to the folder <code>generated_configurations_9d3471e7-a6b3-48e2-ae4b-b9426bb24cd1</code> and run the Terraform plan command. This will show a plan of how many resources will be imported, added, changed and destroyed. </p> </li> <li> <p>Run the command Terraform apply. This will import the Terraform state and store it in the terraform.state file in under the folder <code>generated_configurations_9d3471e7-a6b3-48e2-ae4b-b9426bb24cd1</code>. </p> </li> <li> <p>Now, to modify your BTP resources in this subaccount you can change to Terraform configuration files and run a Terraform apply.</p> </li>"},{"location":"install/","title":"Installation","text":"<p>You have two options to install the btptf CLI:</p> <ol> <li>Download the pre-built binary.</li> <li>Local build</li> </ol> <p>The following sections describe the details for the two options.</p>"},{"location":"install/#pre-built-binary","title":"Pre-Built Binary","text":"<p>The easiest way to get the binary is to download from the releases section of this repository. Select the version that you want to use and download the binary that fits your operating system from the <code>assets</code> of the release. We recommend using the latest version.</p>"},{"location":"install/#local-build","title":"Local Build","text":"<p>If you want to build the binary from scratch, follow these steps:</p> <ol> <li> <p>Open this repository inside VS Code Editor</p> </li> <li> <p>We have setup a devcontainer, so reopen the repository in the devcontainer. We provide devcontainers for Terraform and OpenTofu.</p> </li> <li> <p>Open a terminal in VS Code and install the binary by running</p> </li> </ol> <p><code>bash     make install</code>    This will implicitly trigger a build of the source. If you want to build without install, execute <code>make build</code>.</p> <ol> <li>The system will store the binary as <code>btptf</code> (<code>btptf.exe</code> in case of Windows) in the default binary path of your Go installation <code>$GOPATH/bin</code>.</li> </ol> <p>Tip</p> <p>You find the value of the GOPATH via <code>go env GOPATH</code></p>"},{"location":"limitations/","title":"Limitations","text":""},{"location":"limitations/#supported-resources-for-import","title":"Supported Resources for Import","text":"<p>The btptf CLI can create import blocks and the corresponding configurations only for resources that support the import functionality of Terraform/OpenTofu. Not all resources available in the Terraform providers support this feature and can hence not be imported.</p> <p>You find a list of supported resources for the Terraform Provider for SAP BTP in the corresponding repository on GitHub under the Overview on importable resources.</p>"},{"location":"limitations/#restrictions-for-cloud-foundry","title":"Restrictions for Cloud Foundry","text":"<p>In case of resources for Cloud Foundry the btptf CLI focuses on the resources that are available in the Cloud Foundry environment on SAP BTP. It is not intended to be a generic tool for vanilla Cloud Foundry deployments.</p> <p>You find the details about supported and unsupported Cloud Foundry features on SAP BTP on help.sap.com.</p>"},{"location":"prerequisites/","title":"Prerequisite","text":""},{"location":"prerequisites/#terraformopentofu-cli","title":"Terraform/OpenTofu CLI","text":"<p>The btptf CLI requires a installation of the Terraform CLI or the OpenTofu CLI. The corresponding CLI will be detected and called by the btptf CLI.</p> <p>You find the necessary information in the official documentation:</p> <ul> <li>Terraform.</li> <li>OpenTofu.</li> </ul> <p>Info</p> <p>If you have both CLIs installed you can enforce the usage of one via the environment variable <code>BTPTF_IAC_TOOL</code> namely setting its value to <code>terraform</code>or <code>tofu</code>.</p>"},{"location":"prerequisites/#setting-of-environment-variables","title":"Setting of Environment Variables","text":"<p>Info</p> <p>A complete overview of available parameters is described in the next section.</p> <p>After executing the setup of the btptf CLI, you must set some required environment variables needed for authentication. This section describes the minimum set of environment variables that you must set to execute the btptf CLI successfully:</p> <ol> <li> <p>Set the environment variable <code>BTP_GLOBALACCOUNT</code> which specifies the subdomain of your SAP BTP global account.</p> </li> <li> <p>Depending on the authentication flow, set the following environment variables:</p> <ul> <li>Basic Authentication: set the environment variable <code>BTP_USERNAME</code> and <code>BTP_PASSWORD</code></li> <li>X509 Authentication: set the environment variables <code>BTP_TLS_CLIENT_CERTIFICATE</code>, <code>BTP_TLS_CLIENT_KEY</code>, <code>BTP_TLS_IDP_URL</code></li> </ul> </li> <li> <p>In addition you can set the following optional parameters as environment variables, depending on your requirements:</p> <ul> <li>Specify a custom IdP for the authentication via <code>BTP_IDP</code></li> <li>Specify a URL of the BTP CLI server (SAP internal only) via <code>BTP_CLI_SERVER_URL</code></li> </ul> </li> </ol> <p>The parameters correspond to the Terraform provider configuration options that you find in the BTP Terraform Provider documentation</p> <p>How to set the parameters depends on your setup and is OS-specific:</p> WindowsLinux/Mac <pre><code>$env:BTP_USERNAME=&lt;MY SAP BTP USERNAME&gt;\n</code></pre> <pre><code>export BTP_USERNAME=&lt;MY SAP BTP USERNAME&gt;\n</code></pre> <ul> <li> <p>In a devcontainer:</p> <ul> <li>Create a file <code>devcontainer.env</code> in the <code>.devcontainer</code> directory</li> <li>Add the environment variables in the file. Here is an example:</li> </ul> <p><pre><code>BTP_USERNAME='&lt;MY SAP BTP USERNAME&gt;'\nBTP_PASSWORD='&lt;MY SAP BTP PASSWORD&gt;'\nBTP_GLOBALACCOUNT='&lt;MY SAP BTP GLOBAL ACCOUNT SUBDOMAIN&gt;' #optional\n</code></pre> - Start the devcontainer option <code>Terraform exporter for SAP BTP - Development (with env file)</code>. The environment variables defined in the <code>devcontainer.env</code> file will be automatically injected.</p> <ul> <li>Alternative via <code>.env</code> file (available on MacOS and Linux only):</li> <li>Create a file <code>.env</code> in the root of the project</li> <li>Add the environment variables in the file. Here is an example:</li> </ul> <pre><code>BTP_USERNAME='&lt;MY SAP BTP USERNAME&gt;'\nBTP_PASSWORD='&lt;MY SAP BTP PASSWORD&gt;'\nBTP_GLOBALACCOUNT='&lt;MY SAP BTP GLOBAL ACCOUNT SUBDOMAIN&gt;'\n</code></pre> <ul> <li>Execute the following command in a terminal:</li> </ul> <pre><code>export $(xargs &lt;.env)\n</code></pre> </li> </ul> <p>Info</p> <p>There is no predefined functionality in PowerShell to achieve the same. A custom script is needed.</p>"},{"location":"prerequisites/#overview-of-environment-variables","title":"Overview of Environment Variables","text":"<p>The environment variables supported by the btptf CLI are required to configure the Terraform providers.</p>"},{"location":"prerequisites/#terraform-provider-for-sap-btp","title":"Terraform provider for SAP BTP","text":"<p>For the scenarios where you want to import resources defined in the Terraform provider for SAP BTP the following parameters are available:</p> Environment Variable Name Description BTP_GLOBALACCOUNT The subdomain of the global account from which you want to import resources. BTP_USERNAME Your user name, usually an e-mail address. BTP_PASSWORD Your password. Note that two-factor authentication is not supported. BTP_IDP The identity provider to be used for authentication (only required for custom IDP) BTP_TLS_CLIENT_CERTIFICATE PEM encoded certificate (only required for x509 authentication) BTP_TLS_CLIENT_KEY PEM encoded private key (only required for x509 authentication) BTP_TLS_IDP_URL The URL of the identity provider to be used for authentication (only required for x509 authentication) BTP_CLI_SERVER_URL The URL of the BTP CLI server - Relevant for SAP internal use-cases only"},{"location":"prerequisites/#terraform-provider-for-cloud-foundry","title":"Terraform provider for Cloud Foundry","text":"<p>For the scenarios where you want to import resources defined in the Terraform provider for Cloud Foundry the following parameters are available:</p> Environment Variable Name Description CF_API_URL Specific URL representing the entry point for communication between the client and a Cloud Foundry instance. CF_USER A unique identifier associated with an individual or entity for authentication &amp; authorization purposes. CF_PASSWORD A confidential alphanumeric code associated with a user account on the Cloud Foundry platform, requires user to authenticate. CF_ORIGIN Indicates the identity provider to be used for login CF_CLIENT_ID Unique identifier for a client application used in authentication and authorization processes. CF_CLIENT_SECRET A confidential string used by a client application for secure authentication and authorization, requires cf_client_id to authenticate CF_ACCESS_TOKEN OAuth token to authenticate with Cloud Foundry CF_REFRESH_TOKEN Token to refresh the access token, requires access_token"},{"location":"security/","title":"Security Considerations","text":"<p>When using Terraform Exporter for SAP BTP, following security best practices is key to ensuring that your SAP BTP resources and Terraform configurations are managed safely. Here are some recommended security practices:</p> <ol> <li>Access Control and Least Privilege: Ensure that the user running the Terraform exporter has only the necessary permissions, following the principle of least privilege. This helps minimize the risk of accidental or malicious modifications to resources\u200b. \u200b</li> <li> <p>Secure Storage for State Files: Enable encryption for additional security for Terraform stat files. This is to protect sensitive data in Terraform\u2019s state files, such as resource IDs and secrets. Store these state files in secure, remote back-ends configured with access policies. </p> </li> <li> <p>Network Security and Encryption: When using remote state storage, ensure that data is encrypted both in transit and at rest. </p> </li> <li> <p>Terraform Code and Secrets Management: Avoid hard coding secrets directly in Terraform configurations. Instead, use a secure vault services to manage secrets and inject them into configurations at runtime. This reduces the risk of exposing sensitive information in code repositories\u200b</p> </li> <li> <p>Review and Update Terraform Configurations Regularly: Ensure that exported configurations align with current security and compliance requirements. Regularly review and update configurations, removing any deprecated or unused resources that could expose vulnerabilities.</p> </li> </ol> <p>Following these guidelines can greatly reduce the security risks associated with managing SAP BTP resources using Terraform and Terraform Exporter for SAP BTP.</p>"},{"location":"tfcodeimprovements/","title":"Terraform Configuration Improvements","text":"<p>Info</p> <p>As of now this is an experimental feature and needs to be activated by setting the environment variable <code>BTPTF_EXPERIMENTAL</code> to a non-empty value.</p> <p>The Terraform Exporter for SAP BTP creates the Terraform configuration based on the data available on SAP BTP. This means that the resulting configuration needs manual adjustments before being in a decent state.</p> <p>We are constantly improving this situation by refining the configuration after it gets generated. The following sections give an overview of the improvements.</p>"},{"location":"tfcodeimprovements/#general-configuration-improvements","title":"General Configuration Improvements","text":""},{"location":"tfcodeimprovements/#remove-empty-values","title":"Remove empty values","text":"<p>In general we clean up empty values from the configuration namely if attributes are:</p> <ul> <li><code>null</code></li> <li>empty JSON strings</li> </ul>"},{"location":"tfcodeimprovements/#extract-provider-configuration","title":"Extract Provider configuration","text":"<p>We extract the value of the provider configuration (<code>provider.tf</code> file) as a variable namely:</p> <ul> <li>The subdomain of the SAP BTP global account for the Terraform provider for SAP BTP</li> <li>The API URL of Cloud Foundry for the Terraform provider for Cloud Foundry</li> </ul>"},{"location":"tfcodeimprovements/#improvements-on-subaccount-level","title":"Improvements on Subaccount Level","text":"<p>The Terraform configuration on subaccount level gets improved via the following measures:</p> <ul> <li>The <code>region</code> is extracted as a variable for the resource <code>btp_subaccount</code>.</li> <li>All resources that reference a <code>subaccount_id</code> get transformed to reference the resource <code>btp_subaccount</code> if available.</li> <li>If the attribute <code>parent_id</code> is the global account, it gets removed from the resource <code>btp_subaccount</code>. If not it gets extracted as a variable.</li> <li>If a dependency between the resource <code>btp_subaccount_entitlement</code> and the resource <code>btp_subaccount_subscription</code> exists, a corresponding <code>depends_on</code> block will be added to the resource <code>btp_subaccount_subscription</code>.</li> <li>If a dependency between the resource <code>btp_subaccount_entitlement</code> and the resource <code>btp_subaccount_service_instance</code> exists, a data source <code>btp_subaccount_service_plan</code> is added to fetch the identifier of the service plan. In addition a <code>depends_on</code> block is added to the data source to make it explicitly dependent to the corresponding entitlement. Finally the technical identifier of the service plan is replaced by the reference to the data source</li> <li>If a resource <code>btp_subaccount_trust_configuration</code> gets exported that is the SAP default trust, the corresponding resource is removed from the resource configuration as well as the import block from the corresponding import file.</li> <li>If a resource <code>btp_subaccount_role_collection</code> as well as <code>btp_subaccount_role</code> a check if there are dependencies is executed. If there are any a corresponding <code>depends_on</code> block is added to the resource <code>btp_subaccount_role_collection</code>.</li> </ul>"},{"location":"tfcodeimprovements/#improvements-on-directory-level","title":"Improvements on Directory Level","text":"<ul> <li>If the attribute <code>parent_id</code> is the global account, it gets removed from the resource <code>btp_directory</code>. If not it gets extracted as a variable.</li> <li>All resources that reference a <code>directory_id</code> get transformed to reference the <code>btp_directory</code> resource if available.</li> <li>If a resource <code>btp_directory_role_collection</code> as well as <code>btp_directory_role</code> a check if there are dependencies is executed. If there are any a corresponding <code>depends_on</code> block is added to the resource <code>btp_directory_role_collection</code>.</li> </ul>"},{"location":"tfcodeimprovements/#improvements-on-cloud-foundry-organizational-level","title":"Improvements on Cloud Foundry Organizational Level","text":"<ul> <li>The ID of the organization is extracted as a variable</li> </ul>"}]}